# ソーシャルナビゲーター名称統一・フィルタ再設計 方針

## 1. 名称統一の方針

### 1.1 対象
- フロントエンド表示文: ログイン画面、ヘッダー、サイドバーなど利用者が目にする箇所
- バックエンド/インフラ: ドキュメント、ログ出力、スクリプトのメッセージ、サンプルデータ
- 初期マスターデータ: CSV/マイグレーション内の表記

### 1.2 範囲外
- リポジトリ名 (`saleslist-*`)、Docker イメージ名など構成管理に影響が大きい識別子

### 1.3 実施手順
1. UI 表示文字列を「ソーシャルナビゲーター」に統一
2. ドキュメント・ログメッセージ等の表記を順次置換
3. マスターデータ初期値の文言を更新し、必要に応じてシード/マイグレーションを調整
4. 対象一覧を記録し、レビュー後に変更適用

## 2. フィルタ機構再設計

### 2.1 背景
- 先読み（最大100件）のロジックにより、フィルタ結果が表示済みデータに限定されている
- フィルタ UI が一覧の結果を元に候補抽出しているため、全体に効かない
- クエリパラメータ形式が UI と API で整合しておらず、多値条件が無効化されるケースがある

### 2.2 改修方針
1. **サーバーサイドページングへ統一**
   - `useCompanies` フックを `page`/`page_size` 指定の API 呼び出しに変更し、繰り返し取得ロジックを廃止
   - API レスポンスの `count`/`next` を利用し、ページ切り替え時に再フェッチ

2. **フィルタUIとクエリの整備**
   - フィルタ状態は単一値・配列を明確化し、API が受け取れる形式（多値は反復パラメータ）で送信
   - 空値は送信前に除去し、型をサニタイズ（数値/ブール）

3. **候補ソースの見直し**
   - 業種等の候補は `/master/...` 系 API から取得
   - 必要に応じてバックエンドへ候補取得エンドポイントを追加

4. **バックエンドの強化**
   - `CompanyFilter` のクエリパラメータ形式を見直し（例: `industry` の多値対応）
   - 必要なら索引追加やクエリ最適化を実施

### 2.3 実装ステップ
1. 型定義と `useCompanies` の改修
2. フィルタ UI の状態管理と API 呼び出し統一
3. バックエンド FilterSet の調整とエンドポイント検証
4. 既存テストの更新（Jest/Playwright、API テスト）

---
本計画に基づき、サービス名の統一とフィルタロジックの改修を進めます。

## 3. フィルタ改修 対象一覧（優先順）

1. 案件一覧ページ & `useProjects`
   - サーバーサイドページングへの統一
   - プルダウン条件（進行状況、サービス種別など）の API 化
2. クライアント詳細の企業選択画面 (`/clients/[id]/select-companies`)
   - フィルタ条件の型整合と API 主導化
   - NG 判定（exclude_ng）を含むクエリの再設計
3. そのほかフィルタを持つ画面（NG リスト管理、ダッシュボードなど）
   - 実装状況を調査し、順次サーバーサイド検索へ切り替える

上記優先順で詳細設計→改修→テストを進める。
