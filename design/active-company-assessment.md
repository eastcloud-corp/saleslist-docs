# アクティブ企業判定デザイン案

## 背景
- 取引候補企業を 3 万件以上管理しているが、Facebook をはじめとした外部サービス API で一律自動取得するのは規約上不可能
- 営業支援の観点で「稼働中」「情報が古い」などの状態を可視化したい
- Facebook に依存しない指標を組み合わせ、許諾不要で判定可能な仕組みを設計する

## 判定の基本方針
- **直近の更新アクティビティ** … 社内で管理している接触履歴、ヒアリング結果、メール送受信などから最新接触日を取得
- **公開情報の更新頻度** … 企業の公式サイト、ニュースリリース、ブログ、求人など「公開されているソース」から更新日をチェック
- **営業上の反応指標** … メール開封やキャンペーン応答など、既存の Marketing Automation (MA)／CRM データ
- **外部データソース** … オープンデータ（官報、PR Times 等）の更新状況を収集

上記をスコア化・閾値設定して「アクティブ／要確認／非アクティブ」を判定する

## 判定ロジックの例
1. **社内タッチポイント (内部データ)**
   - 最終接触日が 3 ヶ月以内 → スコア +3
   - 最終接触が 6 ヶ月以内 → スコア +2
   - 最終接触が 6 ヶ月以上 → スコア +0
   - 稼働案件の有無、見積中フラグなども加点対象

2. **公開サイト更新状況 (スクレイプ可否に注意)**
   - 公式サイトの RSS / ニュース欄の最終更新 → 30 日以内なら +2、90 日以内 +1
   - 正規に取得可能なプレスリリース (PR Times API など) の更新
   - ※禁止されているスクレイピングは行わない。RSS や提供 API を利用する

3. **MA / メルマガ応答**
   - 直近キャンペーンの開封 30 日以内 → +2
   - 未開封連続 N 回 → マイナス補正
   - 返信・フォーム送信あり → +3

4. **外部オープンデータ**
   - 官報掲載、行政リリースなど公式情報の更新
   - 求人サイトに新着求人がある → 採用活動が活発 → +1

5. **合計スコアに応じて判定**
   - スコア >= 6: アクティブ
   - スコア 3-5: 要フォロー (音沙汰なし→連絡推奨)
   - スコア < 3: 非アクティブ (情報更新依頼を検討)

判定はダッシュボード上で定期バッチ（例: 1日1回）と手動更新を併用

## システム構成案
- **データソース**
  - 内部 CRM / SFA: 最終接触日、ステージ、担当者メモ
  - MA ツール: メール開封・クリック、フォーム送信
  - サイト更新情報: RSS/公式 API を活用。スクレイピング禁止
  - 外部 API: PR Times、求人 API など利用を検討

- **データ取得**
  - 既存の ETL バッチまたはスケジュールされた Lambda/Cloud Functions で情報収集
  - 収集したデータは中間テーブルに保存 (例: `company_external_updates`, `company_activity_score`)

- **判定バッチ**
  - 毎日夜間にバッチ処理を実行。
  - スコアリングロジックを実装し、閾値に応じたステータス更新 (`active`, `watch`, `inactive`)
  - 直近の変化があれば営業リストに通知

## 画面イメージ
- **企業一覧**: ステータスラベル (アクティブ/要フォロー/非アクティブ)、最終更新日/接触日を表示
- **企業詳細**: 判定に使ったデータを分解して表示 (最新ニュース日付、最終メール開封日など)
- **アラート**: 非アクティブに落ちた企業を通知、営業担当へワークフロー割当

## 今後のタスク
- [ ] 既存データソースの棚卸 (どの情報がどのシステムにあるか)
- [ ] 収集対象のオープン API・RSS をリストアップ
- [ ] スコアリング規則の詳細定義 (営業部門とすり合わせ)
- [ ] バッチ処理の設計 (再スコアリング頻度・ログ設計)
- [ ] UI/通知フローのユースケース整理

